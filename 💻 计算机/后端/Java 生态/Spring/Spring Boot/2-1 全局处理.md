# â¤ï¸ è¿‡æ»¤å™¨
è¿‡æ»¤å™¨ ä¸»è¦ç”¨äºå¯¹è¯·æ±‚å’Œå“åº”è¿›è¡Œé¢„å¤„ç†å’Œåå¤„ç†
- `init()` åœ¨è¿‡æ»¤å™¨å®ä¾‹åŒ–ä¹‹åï¼Œè¯·æ±‚å¤„ç†ä¹‹å‰è°ƒç”¨
- `doFilter()` è¯¥è¿‡æ»¤å™¨çš„æ ¸å¿ƒæ–¹æ³•ï¼Œç”¨äºå¯¹è¯·æ±‚å’Œå“åº”åšå‡ºå¤„ç†
- `destroy()` åœ¨è¿‡æ»¤å™¨é”€æ¯ä¹‹å‰è°ƒç”¨
```java
@WebFilter("/*") // æ³¨è§£æ–¹å¼ï¼Œè¡¨ç¤ºæ‹¦æˆªæ‰€æœ‰è·¯å¾„
public class MyFilter implements Filter {
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        // åˆå§‹åŒ–æ“ä½œï¼Œå¯ä»¥è¯»å–filteré…ç½®
        System.out.println("Filter initialized");
    }

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {
        
        // å‰ç½®å¤„ç†ï¼šè®°å½•è¯·æ±‚å¼€å§‹æ—¶é—´
        long startTime = System.currentTimeMillis();
        System.out.println("Request received at: " + startTime);
        
        // ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨æˆ–ç›®æ ‡èµ„æº
        chain.doFilter(request, response);
        
        // åç½®å¤„ç†ï¼šè®¡ç®—è¯·æ±‚å¤„ç†æ—¶é—´
        long endTime = System.currentTimeMillis();
        System.out.println("Request processed in: " + (endTime - startTime) + " ms");
    }

    @Override
    public void destroy() {
        // é”€æ¯æ“ä½œ
        System.out.println("Filter destroyed");
    }
}
```

# â¤ï¸ å…¨å±€å¼‚å¸¸å¤„ç†
é€šè¿‡å®šä¹‰<u>å…¨å±€å¼‚å¸¸å¤„ç†å™¨</u>æ¥ç»Ÿä¸€å¤„ç†æŠ›å‡ºçš„å¼‚å¸¸ ï¼š
- `@RestControllerAdvice` è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå…¨å±€å¼‚å¸¸å¤„ç†å™¨
- `@ExceptionHandler` æŒ‡å®šè¦æ•è·å“ªä¸€ç±»å‹çš„å¼‚å¸¸

```java
@RestControllerAdvice
public class GlobalExceptionHandler {
	/**  
	 * å…¨å±€å¼‚å¸¸å¤„ç†ï¼Œæ•è·æ‰€æœ‰å¼‚å¸¸
	 */
    @ExceptionHandler(Exception.class)  
    public Result ex(Exception ex) {
        return Result.buildResult(Result.Status.UNAUTHORIZED, "ç¦æ­¢è®¿é—®", "http://localhost:7000/Exception#/Exception");
    }
}
```

## ğŸ’› ProblemDetail
<u>å¦‚ä½•ä½¿ç”¨</u> ï¼šExceptionHandler é€šå¸¸ä¼šå’Œ ProblemDetail è¿›è¡Œæ­é…ä½¿ç”¨
- æ‰©å±•å­—æ®µ `setProperty(String key, Object value)` 
```java
@ExceptionHandler(MyBusinessException.class)
public ProblemDetail handleBusinessException(MyBusinessException ex) {
	ProblemDetail problem = ProblemDetail.forStatus(HttpStatus.BAD_REQUEST);
	problem.setTitle("Business Rule Violation");
	problem.setDetail(ex.getMessage());
	problem.setProperty("errorCode", ex.getCode());
	return problem;
}

@ExceptionHandler(RuntimeException.class)
public ProblemDetail runtimeExceptionHandler(RuntimeException e) {
	log.error(e.getMessage(), e);
	return ProblemDetail.forStatusAndDetail(HttpStatus.BAD_REQUEST, e.getMessage());
}
```

<u>è¿”å›æ ¼å¼</u> ï¼š
- `type` é”™è¯¯ç±»å‹çš„æ ‡è¯† URIï¼Œé”™è¯¯æ–‡æ¡£å¤§å…¨ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰
- `title` é”™è¯¯çš„ç®€è¦æè¿°ï¼ˆä¸ä¼ åˆ™ä¸ºé”™è¯¯ç ï¼‰
- `status` http çŠ¶æ€ç ï¼ˆå¯ä»¥ä¸ä¼ ï¼‰
- `detail` å…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰
- `instance` å‡ºé”™çš„å…·ä½“è¯·æ±‚è·¯å¾„æˆ–å®ä¾‹ URIï¼ˆå¯ä»¥ä¸ä¼ ï¼‰
```json
{
  "type": "https://example.com/errors/not-found",
  "title": "Resource Not Found",
  "status": 404,
  "detail": "The item you requested was not found",
  "instance": "/api/items/123"
}
```

