https://cloud.baidu.com/article/3318850
https://blog.csdn.net/Andya_net/article/details/131188311

# â¤ SpringBoot çš„å¯åŠ¨æµç¨‹
## å¯åŠ¨ç±»çš„ main æ–¹æ³•
- é¦–å…ˆï¼Œä»ä¸€ä¸ªæ ‡æ³¨äº† @SpringBootApplication çš„ main æ–¹æ³•å¼€å§‹
- è¿è¡Œ run() æ–¹æ³•ï¼ŒæŠŠä¸»ç±»ï¼Œå’Œ args å‚æ•°ä¼ é€’è¿›å»

```java
@SpringBootApplication
public class KafkaApplication {
    public static void main(String[] args) {
        SpringApplication.run(KafkaApplication.class, args);
    }
}
```

## åˆ›å»º ApplicationContext
æ ¹æ®åº”ç”¨ç±»å‹ï¼Œåˆ›å»ºç›¸åº”çš„ ApplicationContext

## åˆ·æ–° ApplicationContext
åŠ è½½å¹¶åˆå§‹åŒ–æ‰€æœ‰çš„ Bean

## è‡ªåŠ¨é…ç½®
æ ¹æ®ä¾èµ–ï¼Œå’Œ application é…ç½®æ–‡ä»¶è¿›è¡Œè‡ªåŠ¨é…ç½®

## å¯åŠ¨å†…åµŒæœåŠ¡å™¨
å¦‚æœæ˜¯ Web åº”ç”¨ï¼Œåˆ™å¯åŠ¨


## æ‰§è¡Œ CommandLineRunner å’Œ ApplicationRunner
`ApplicationRunner` æ˜¯ SpringBoot çš„å¯åŠ¨è¿è¡Œå™¨ï¼Œå®ƒä¼šåœ¨åº”ç”¨ç¨‹åºå¯åŠ¨å®Œæˆåæ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œ

```java
@Component
public class KafkaProducerConfig {
    // åœ¨å¯åŠ¨æ—¶ï¼Œæ‰§è¡Œä¸€äº›æ“ä½œ
    @Bean
    public ApplicationRunner runner(KafkaTemplate<String, String> kafkaTemplate) {
        return args -> {
            kafkaTemplate.send("TopicTwo", "Hello World");
        };
    }
}
```

# â¤ï¸ ç¯å¢ƒä¸Šä¸‹æ–‡

> [!NOTE] SpringBoot åœ¨å¯åŠ¨åï¼Œåœ¨ä¸åŒçš„è¿è¡Œé˜¶æ®µä¼šè®¾ç½®æ‰©å±•ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€æ±‚åœ¨æŒ‡å®šé˜¶æ®µï¼Œæ‰§è¡Œè‡ªå®šä¹‰çš„ä»£ç 

## ApplicationContext

> [!quote] `ApplicationContext`ã€åº”ç”¨ä¸Šä¸‹æ–‡ã€‘
> `ApplicationContext` æ˜¯ Spring æ ¸å¿ƒæ¥å£ä¹‹ä¸€ï¼Œæ˜¯ Spring ä¸­å®ç° IOC å’Œ DI çš„å®¹å™¨ï¼Œ<u>ç”¨äºå­˜å‚¨åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ‰€éœ€çš„å„ç§ Bean å¯¹è±¡ï¼Œå¹¶è´Ÿè´£å®ä¾‹åŒ–ï¼Œé…ç½®ï¼Œç»„è£…è¿™äº› Bean</u>ã€å½“ä¸€ä¸ª Bean éœ€è¦å¦ä¸€ä¸ª Bean ä½œä¸ºä¾èµ–æ—¶ï¼Œ`ApplicationContext` å°±ä¼šè´Ÿè´£å¯»æ‰¾å’Œæ³¨å…¥ç›¸åº”çš„ Beanã€‘

> [!warning] ä¸€æ—¦ `ApplicationContext` å·²ç»åˆ·æ–°ï¼ŒBean çš„å®šä¹‰å°±ä¸èƒ½å†è¢«ä¿®æ”¹äº†ï¼Œ**ä½†æ˜¯ï¼Œä½ åº”è¯¥å°½é‡é¿å…åœ¨è¿è¡Œæ—¶ä¿®æ”¹ Bean çš„å®šä¹‰ï¼Œè€Œæ˜¯åº”è¯¥åœ¨é…ç½®é˜¶æ®µå°±ç¡®å®šå¥½ Bean çš„å®šä¹‰**

`ApplicationContext` åŒ…å«ä¸€ä¸ª Environmentï¼Œè¿™ä¸ª Environment ä¿å­˜äº†æ‰€æœ‰è·Ÿåº”ç”¨ç¨‹åºè¿è¡Œç¯å¢ƒæœ‰å…³çš„å±æ€§ã€ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼ŒJVM ç³»ç»Ÿå±æ€§ï¼Œå‘½ä»¤è¡Œå‚æ•°ï¼Œåº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶â€¦â€¦ã€‘

## ApplicationContextInitializer

> [!quote] `ApplicationContextInitializer`
> `ApplicationContextInitializer` å°±æ˜¯ SpringBoot ä¼—å¤šæ‰©å±•ç‚¹ä¸­çš„ä¸€ä¸ªï¼Œ<u>åœ¨ IOC å®¹å™¨åˆ›å»ºå®Œæˆå</u>ï¼Œ <u>`ApplicationContext` åˆ·æ–°å‰</u>ã€å®Œå…¨åˆå§‹åŒ– Bean ä¹‹å‰ã€‘æ‰§è¡Œ

> [!hint] `ApplicationContextInitializer` çš„ä½œç”¨
> 
> > å¯¹ä¸Šä¸‹æ–‡ç¯å¢ƒåšä¸€äº›æ“ä½œï¼š
> > - åŠ¨æ€æ”¹å˜ Spring é…ç½®å±æ€§ã€ä¿®æ”¹ Bean å®šä¹‰ã€‘
> > - ä¿®æ”¹ `ApplicationContext` çš„ç¯å¢ƒå±æ€§
> 
> ä½ å¯ä»¥æ ¹æ®è¿è¡Œç¯å¢ƒçš„ä¸åŒï¼ŒåŠ¨æ€åœ°ä¿®æ”¹åº”ç”¨ç¨‹åºçš„é…ç½®ã€ä½ å¯èƒ½åœ¨å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“é…ç½®ï¼Œæˆ–è€…åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šè¿è¡Œæ—¶ä½¿ç”¨ä¸åŒçš„æœåŠ¡ç«¯å£ â€¦â€¦ã€‘

<u>å…·ä½“å®ç°</u> ï¼š
- åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ç° `ApplicationContextInitializer` æ¥å£ï¼Œå¹¶ç»§æ‰¿ `initialize æ–¹æ³•`
```java
package com.example.web_2.initializer;

public class MyApplicationContextInitializer implements ApplicationContextInitializer {
    @Override
    public void initialize(ConfigurableApplicationContext applicationContext) {
        // å‡†å¤‡å±æ€§
        Map<String, Object> myMap = new HashMap<>();
        myMap.put("applicationName", "big-events");

        // è·å–ç¯å¢ƒå¯¹è±¡
        ConfigurableEnvironment environment = applicationContext.getEnvironment();
        // è·å–å±æ€§æº
        MutablePropertySources propertySources = environment.getPropertySources();

        // æ·»åŠ å±æ€§
        propertySources.addLast(new MapPropertySource("myPropertySource", myMap));
    }
}
```
- åœ¨ `META-INF/spring.factories` ä¸­æ³¨å†Œè¿™ä¸ªåˆå§‹åŒ–å™¨
```factories
# æ¥å£çš„å…¨ç±»å=å®ç°ç±»çš„å…¨ç±»å
org.springframework.context.ApplicationContextInitializer=com.example.web_2.initializer.MyApplicationContextInitializer
```
- æµ‹è¯•ä¸€ä¸‹
```java
@SpringBootApplication
public class Web2Application {
    public static void main(String[] args) {
        // è·å–ä¸Šä¸‹æ–‡å¯¹è±¡
        ConfigurableApplicationContext run = SpringApplication.run(Web2Application.class, args);
        String applicationName = run.getEnvironment().getProperty("applicationName");
        System.out.println("applicationName = " + applicationName);
    }
}

---
applicationName = big-events
```



# â¤ ç¦ç”¨ä¾èµ–
æœ‰æ—¶æˆ‘ä»¬æƒ³å¿«é€Ÿå¯åŠ¨é¡¹ç›®ï¼Œä¸ä½¿ç”¨æŸäº›åœ¨ Maven ä¸­å¼•å…¥çš„ä¾èµ–ï¼Œæ¯”å¦‚æ•°æ®åº“ï¼Œæ¶ˆæ¯é˜Ÿåˆ— â€¦â€¦ ï¼Œæˆ‘ä»¬<u>å¯ä»¥ç›´æ¥ç¦ç”¨æ‰ç”¨åˆ°è¿™äº›ä¾èµ–çš„ Bean åŠ è½½</u>

---

- åœ¨å¯åŠ¨ç±»åŠ ä¸Š `exclude` ï¼Œå°±èƒ½å¿«é€Ÿç¦ç”¨æŸäº›ä¾èµ–çš„è‡ªåŠ¨åŠ è½½
```java
@SpringBootApplication(exclude = {RocketMQAutoConfiguration.class})
```

- ç¦ç”¨äº† RocketMQ Bean çš„åˆå§‹åŒ–åï¼Œæˆ‘ä»¬è¿˜è¦å¯¹ç”¨åˆ°è¿™ä¸ª Bean çš„åœ°æ–¹è¿›è¡Œ `@Lazy` æ‡’åŠ è½½ï¼Œè®©å…¶ä¸ä¼šå› ä¸ºç¼ºå¤± Bean è€ŒæŠ¥é”™
```java
public class MQProducer {
    @Autowired
    @Lazy
    private RocketMQTemplate rocketMQTemplate;
}
```

# â¤ï¸ çº¿ç¨‹æ± 
> [!NOTE] 
> Spring é»˜è®¤æœ‰ä¸€ä¸ª main ä¸»çº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹æ˜¯ç”¨æ¥å¯åŠ¨ Spring å’Œåˆå§‹åŒ– App èµ„æºçš„ã€‚Spring ä¸»è¦ä¾é  Servlet å®¹å™¨ä¸­çš„çº¿ç¨‹æ± æ¥å¤„ç†å¤§é‡çš„å¹¶å‘ç”¨æˆ·è¯·æ±‚
> 
> å¦‚æœä½ éœ€è¦æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œä½†æ˜¯ä½ åˆä¸å•ç‹¬é…ç½®å¼‚æ­¥çº¿ç¨‹æ± ï¼Œé‚£ä¹ˆå¼‚æ­¥ä»»åŠ¡å°±ä¼šå’Œ Servlet å®¹å™¨ä¸­çš„çº¿ç¨‹æŠ¢å¤ºèµ„æº

## ğŸ’› å¼‚æ­¥çº¿ç¨‹æ± 
å¼‚æ­¥æ‰§è¡Œçº¿ç¨‹æ± åªä¸“æ³¨äºå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œï¼Œéœ€è¦åŠ ä¸Š `@EnableAsync` 

```java
@Configuration
public class AsyncTaskConfig {  
    @Bean(name = "myAsyncExecutorThreadPool")  
    public Executor myAsyncExecutorThreadPool() {  
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor(); 
        executor.setCorePoolSize(30);  // æ ¸å¿ƒçº¿ç¨‹æ•°  
        executor.setMaxPoolSize(50);  // æœ€å¤§çº¿ç¨‹æ•°  
        executor.setQueueCapacity(100);  // é˜Ÿåˆ—å®¹é‡  
        executor.setThreadNamePrefix("MyAsyncExecutorThreadPool - ");  
        executor.initialize();  
        return executor;  
    }  
}
```

```java
// ä½¿ç”¨
@Async("myAsyncExecutorThreadPool")
public Future<String> asyncTask() {
	// æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡
	Thread.sleep(2000);
	System.out.println("å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•");
	return new AsyncResult<>("Task Completed");
}
```

# â¤ï¸ è™šæ‹Ÿçº¿ç¨‹

# â¤ï¸ å…¶ä»–æ“ä½œ
<u>å°† tomcat æ”¹ä¸º undertow</u> ï¼šundertow æ¯” tomcat æ›´é€‚åˆé«˜å¹¶å‘
- æ›´æ–°ä¾èµ–
```xml
<dependencies>
    <!-- ç§»é™¤ Spring Boot é»˜è®¤çš„ tomcat -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
        <exclusions>
            <exclusion>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-tomcat</artifactId>
            </exclusion>
        </exclusions>
    </dependency>

    <!-- æ·»åŠ  Undertow -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-undertow</artifactId>
    </dependency>
</dependencies>
```
- yml é…ç½®
```yml
server:
  port: 8080
  undertow:
    io-threads: 8
    worker-threads: 64
    buffer-size: 1024
    direct-buffers: true
```